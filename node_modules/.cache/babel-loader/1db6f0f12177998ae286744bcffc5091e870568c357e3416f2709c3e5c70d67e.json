{"ast":null,"code":"import React,{useEffect,useState}from'react';import Fonts from'./resource/fonts.json';import ConvertList from'./resource/letter_convert_list.json';import'./App.css';import FontButton from'./FontButton';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";/**\n * 絵文字名変換表\n */const convertList=ConvertList;const Main=()=>{/** 絵文字にする文字列 */const[text,setText]=useState('');/**\n   * 選択中のフォント名\n   */const[selectedFont,setSelectedFont]=useState(Fonts[0]);/**\n   * 色\n   */const[color,setColor]=useState('#000000');/**\n   * 最大級サーバー向け文字変換関数\n   */const createEmojiName=()=>{let convertedText=text;// 変換表に基づいて変換\nObject.keys(convertList).forEach(letter=>{convertedText.replaceAll(letter,convertList[letter]);});// 長音記号は前の文字と一致させる\nlet i=0;while(convertedText.indexOf(\"ー\",i)>-1){const preLetter=convertedText[convertedText.indexOf(\"ー\",i)-1];console.log(preLetter);convertedText=convertedText.replace(\"ー\",preLetter);i++;}};const[png,setPng]=useState(null);useEffect(()=>{const fontSize=32;const pngDataArr=[];// draw\nconst textLine=text.split('\\n');textLine.forEach((line,i)=>{const canvas=document.createElement('canvas');canvas.width=128;canvas.height=128/(4/textLine.length);const ctx=canvas.getContext('2d');ctx.fillStyle=color;ctx.font=`${fontSize}px '${selectedFont.name}', serif`;ctx.scale(4/line.length,4/textLine.length);ctx.fillText(line,0,0);//((canvas.height / textLine.length) * i) / (4 / textLine.length));\npngDataArr.push(canvas.toDataURL());});const canvas=document.createElement('canvas');canvas.width=128;canvas.height=128;//setPng(concatCanvas(canvas, pngDataArr));\nsetPng(pngDataArr[0]);},[text,selectedFont]);/**\n   * Canvas合成\n   * @param {string} canvas 合成結果を描画するcanvas\n   * @param {array} pngDataArr 合成するpng\n   * @returns {string} png\n   */const concatCanvas=(canvas,pngDataArr)=>{const ctx=canvas.getContext(\"2d\");for(let i=0;i<pngDataArr.length;i++){const image=new Image();image.src=pngDataArr[i];ctx.drawImage(image,0,0,canvas.width,canvas.height);}return canvas.toDataURL();};/**\n   * テキストエリア要素変更イベント\n   * @param e textarea要素変更イベント\n   */const handleTextChange=e=>{setText(e.target.value);};return/*#__PURE__*/_jsxs(\"div\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"textarea\",{value:text,style:{fontFamily:selectedFont.name},onChange:handleTextChange})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"font\",children:/* フォントボタン */Fonts.map(font=>{return/*#__PURE__*/_jsx(FontButton,{text:text,font:font,pressed:selectedFont.name===font.name,onClick:()=>{setSelectedFont(font);}},font.name);})})}),png&&/*#__PURE__*/_jsx(\"div\",{className:\"comp\",style:{display:'flex'},children:/*#__PURE__*/_jsx(\"img\",{alt:\"result\",src:png})})]});};const App=()=>{return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"link\",{rel:\"preconnect\",href:\"https://fonts.googleapis.com\"}),/*#__PURE__*/_jsx(\"link\",{href:`https://fonts.googleapis.com/css2?${Fonts.map(font=>'family='+font.name.replaceAll(' ','+')).join('&')}&display=swap`,rel:\"stylesheet\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"Emoji Generator for Misskey\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main\",children:/*#__PURE__*/_jsx(Main,{})})]});};export default App;","map":{"version":3,"names":["React","useEffect","useState","Fonts","ConvertList","FontButton","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","convertList","Main","text","setText","selectedFont","setSelectedFont","color","setColor","createEmojiName","convertedText","Object","keys","forEach","letter","replaceAll","i","indexOf","preLetter","console","log","replace","png","setPng","fontSize","pngDataArr","textLine","split","line","canvas","document","createElement","width","height","length","ctx","getContext","fillStyle","font","name","scale","fillText","push","toDataURL","concatCanvas","image","Image","src","drawImage","handleTextChange","e","target","value","className","children","style","fontFamily","onChange","map","pressed","onClick","display","alt","App","rel","href","join"],"sources":["/Volumes/EXTHDD/Macmini/misskey/emojiCreator/pagesTest/src/App.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport ReactDOMServer from \"react-dom/server\";\nimport Fonts from './resource/fonts.json'\nimport ConvertList from './resource/letter_convert_list.json'\nimport './App.css';\nimport FontButton from './FontButton';\nimport EmojiPreviewBox from './EmojiPreviewBox';\n\n/**\n * 絵文字名変換表\n */\nconst convertList: { [key: string]: string } = ConvertList;\n\nconst Main = () => {\n  /** 絵文字にする文字列 */\n  const [text, setText] = useState('');\n\n  /**\n   * 選択中のフォント名\n   */\n  const [selectedFont, setSelectedFont] = useState(Fonts[0]);\n\n  /**\n   * 色\n   */\n  const [color, setColor] = useState('#000000');\n\n  /**\n   * 最大級サーバー向け文字変換関数\n   */\n  const createEmojiName = () => {\n    let convertedText = text;\n\n    // 変換表に基づいて変換\n    Object.keys(convertList).forEach((letter: string) => {\n      convertedText.replaceAll(letter, convertList[letter]);\n    });\n\n    // 長音記号は前の文字と一致させる\n    let i = 0;\n    while (convertedText.indexOf(\"ー\", i) > -1) {\n      const preLetter = convertedText[convertedText.indexOf(\"ー\", i) - 1];\n      console.log(preLetter);\n      convertedText = convertedText.replace(\"ー\", preLetter);\n      i++;\n    }\n  }\n\n  const [png, setPng] = useState<string | null>(null)\n\n  useEffect(() => {\n    const fontSize = 32;\n    const pngDataArr: string[] = [];\n\n    // draw\n    const textLine = text.split('\\n');\n    textLine.forEach((line, i) => {\n      const canvas = document.createElement('canvas');\n      canvas.width = 128;\n      canvas.height = 128 / (4 / textLine.length);\n      const ctx = canvas.getContext('2d')!;\n      ctx.fillStyle = color;\n      ctx.font = `${fontSize}px '${selectedFont.name}', serif`;\n      ctx.scale(4 / line.length, 4 / textLine.length);\n      ctx.fillText(line, 0, 0);//((canvas.height / textLine.length) * i) / (4 / textLine.length));\n\n      pngDataArr.push(canvas.toDataURL());\n    });\n\n    const canvas = document.createElement('canvas');\n    canvas.width = 128;\n    canvas.height = 128;\n    //setPng(concatCanvas(canvas, pngDataArr));\n    setPng(pngDataArr[0])\n  }, [text, selectedFont])\n\n  /**\n   * Canvas合成\n   * @param {string} canvas 合成結果を描画するcanvas\n   * @param {array} pngDataArr 合成するpng\n   * @returns {string} png\n   */\n  const concatCanvas = (canvas: HTMLCanvasElement, pngDataArr: string[]): string => {\n    const ctx = canvas.getContext(\"2d\")!;\n\n    for (let i = 0; i < pngDataArr.length; i++) {\n      const image = new Image();\n      image.src = pngDataArr[i];\n      ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n    }\n\n    return canvas.toDataURL();\n  }\n\n  /**\n   * テキストエリア要素変更イベント\n   * @param e textarea要素変更イベント\n   */\n  const handleTextChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setText(e.target.value);\n  };\n\n  return (\n    <div className=\"App-header\">\n      <div>\n        {/* テキスト */}\n        <textarea value={text} style={{ fontFamily: selectedFont.name }} onChange={handleTextChange} />\n      </div>\n      <div>\n        <span className='font'>\n          {\n            /* フォントボタン */\n            Fonts.map((font) => {\n              return <FontButton key={font.name} text={text} font={font} pressed={selectedFont.name === font.name} onClick={() => { setSelectedFont(font); }} />\n            })\n          }\n        </span>\n      </div>\n      {png && (\n        <div className=\"comp\" style={{ display: 'flex' }}>\n          <img alt=\"result\" src={png} />\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst App = () => {\n  return (\n    <>\n      {/* フォント読み込み */}\n      <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n      <link href={`https://fonts.googleapis.com/css2?${Fonts.map((font) => 'family=' + font.name.replaceAll(' ', '+')).join('&')}&display=swap`} rel=\"stylesheet\" />\n      <h1>Emoji Generator for Misskey</h1>\n      <div className=\"main\">\n        <Main />\n      </div>\n    </>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}