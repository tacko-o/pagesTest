{"ast":null,"code":"import '../App.css';\n/**\n * プレビュー用canvas描画\n */\nexport async function getPng(text, font, color, borderColor, borderWidth) {\n  return new Promise((resolve, reject) => {\n    try {\n      const fontSize = 34;\n      const canvas = document.createElement('canvas');\n      canvas.width = 128;\n      canvas.height = 128;\n      const ctx = canvas.getContext('2d');\n      ctx.fillStyle = color;\n      ctx.strokeStyle = borderColor;\n      ctx.lineWidth = borderWidth;\n      ctx.lineJoin = 'round';\n      ctx.font = `${fontSize}px '${font.name}', serif`;\n      ctx.textBaseline = 'top';\n      const textLine = text.split('\\n');\n\n      // stroke\n      if (borderWidth > 0) {\n        textLine.forEach((line, i) => {\n          ctx.save();\n          const lineWidth = ctx.measureText(line).width;\n          // ctx.scale(0.9 * canvas.width / lineWidth, 0.9 * canvas.height / (fontSize * textLine.length));\n          ctx.font = `${canvas.width / textLine.length}px '${font.name}', serif`;\n          ctx.strokeText(line, 0, fontSize * 0.9 * i, canvas.width);\n          ctx.restore();\n        });\n      }\n\n      // fill\n      textLine.forEach((line, i) => {\n        ctx.save();\n        const lineWidth = ctx.measureText(line).width;\n        ctx.scale(0.9 * canvas.width / lineWidth, 0.9 * canvas.height / (fontSize * textLine.length));\n        ctx.fillText(line, 0.1 * canvas.width / lineWidth, fontSize * 0.9 * (i + 1));\n        ctx.restore();\n      });\n      resolve(canvas.toDataURL());\n    } catch (e) {\n      reject();\n    }\n  });\n}","map":{"version":3,"names":["getPng","text","font","color","borderColor","borderWidth","Promise","resolve","reject","fontSize","canvas","document","createElement","width","height","ctx","getContext","fillStyle","strokeStyle","lineWidth","lineJoin","name","textBaseline","textLine","split","forEach","line","i","save","measureText","length","strokeText","restore","scale","fillText","toDataURL","e"],"sources":["/Volumes/EXTHDD/Macmini/misskey/emojiCreator/pagesTest/src/utils/EmojiRenderer.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport '../App.css';\nimport { Font } from '../components/FontButton';\n\n/**\n * プレビュー用canvas描画\n */\nexport async function getPng(text: string, font: Font, color: string, borderColor: string, borderWidth: number): Promise<string> {\n  return new Promise((resolve, reject) => {\n    try {\n      const fontSize = 34;\n      const canvas = document.createElement('canvas');\n      canvas.width = 128;\n      canvas.height = 128;\n      const ctx = canvas.getContext('2d')!;\n      ctx.fillStyle = color;\n      ctx.strokeStyle = borderColor;\n      ctx.lineWidth = borderWidth;\n      ctx.lineJoin = 'round';\n      ctx.font = `${fontSize}px '${font.name}', serif`;\n      ctx.textBaseline = 'top';\n      const textLine = text.split('\\n');\n\n      // stroke\n      if (borderWidth > 0) {\n        textLine.forEach((line, i) => {\n          ctx.save();\n          const lineWidth = ctx.measureText(line).width;\n          // ctx.scale(0.9 * canvas.width / lineWidth, 0.9 * canvas.height / (fontSize * textLine.length));\n          ctx.font = `${canvas.width / textLine.length}px '${font.name}', serif`;\n          ctx.strokeText(line, 0, (fontSize * 0.9) * (i), canvas.width);\n          ctx.restore();\n        });\n      }\n\n      // fill\n      textLine.forEach((line, i) => {\n        ctx.save();\n        const lineWidth = ctx.measureText(line).width;\n        ctx.scale(0.9 * canvas.width / lineWidth, 0.9 * canvas.height / (fontSize * textLine.length));\n        ctx.fillText(line, 0.1 * canvas.width / lineWidth, (fontSize * 0.9) * (i + 1));\n        ctx.restore();\n      });\n      resolve(canvas.toDataURL());\n    } catch (e) {\n      reject();\n    }\n  });\n}"],"mappings":"AACA,OAAO,YAAY;AAGnB;AACA;AACA;AACA,OAAO,eAAeA,MAAMA,CAACC,IAAY,EAAEC,IAAU,EAAEC,KAAa,EAAEC,WAAmB,EAAEC,WAAmB,EAAmB;EAC/H,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC,IAAI;MACF,MAAMC,QAAQ,GAAG,EAAE;MACnB,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;MAC/CF,MAAM,CAACG,KAAK,GAAG,GAAG;MAClBH,MAAM,CAACI,MAAM,GAAG,GAAG;MACnB,MAAMC,GAAG,GAAGL,MAAM,CAACM,UAAU,CAAC,IAAI,CAAE;MACpCD,GAAG,CAACE,SAAS,GAAGd,KAAK;MACrBY,GAAG,CAACG,WAAW,GAAGd,WAAW;MAC7BW,GAAG,CAACI,SAAS,GAAGd,WAAW;MAC3BU,GAAG,CAACK,QAAQ,GAAG,OAAO;MACtBL,GAAG,CAACb,IAAI,GAAG,GAAGO,QAAQ,OAAOP,IAAI,CAACmB,IAAI,UAAU;MAChDN,GAAG,CAACO,YAAY,GAAG,KAAK;MACxB,MAAMC,QAAQ,GAAGtB,IAAI,CAACuB,KAAK,CAAC,IAAI,CAAC;;MAEjC;MACA,IAAInB,WAAW,GAAG,CAAC,EAAE;QACnBkB,QAAQ,CAACE,OAAO,CAAC,CAACC,IAAI,EAAEC,CAAC,KAAK;UAC5BZ,GAAG,CAACa,IAAI,CAAC,CAAC;UACV,MAAMT,SAAS,GAAGJ,GAAG,CAACc,WAAW,CAACH,IAAI,CAAC,CAACb,KAAK;UAC7C;UACAE,GAAG,CAACb,IAAI,GAAG,GAAGQ,MAAM,CAACG,KAAK,GAAGU,QAAQ,CAACO,MAAM,OAAO5B,IAAI,CAACmB,IAAI,UAAU;UACtEN,GAAG,CAACgB,UAAU,CAACL,IAAI,EAAE,CAAC,EAAGjB,QAAQ,GAAG,GAAG,GAAKkB,CAAE,EAAEjB,MAAM,CAACG,KAAK,CAAC;UAC7DE,GAAG,CAACiB,OAAO,CAAC,CAAC;QACf,CAAC,CAAC;MACJ;;MAEA;MACAT,QAAQ,CAACE,OAAO,CAAC,CAACC,IAAI,EAAEC,CAAC,KAAK;QAC5BZ,GAAG,CAACa,IAAI,CAAC,CAAC;QACV,MAAMT,SAAS,GAAGJ,GAAG,CAACc,WAAW,CAACH,IAAI,CAAC,CAACb,KAAK;QAC7CE,GAAG,CAACkB,KAAK,CAAC,GAAG,GAAGvB,MAAM,CAACG,KAAK,GAAGM,SAAS,EAAE,GAAG,GAAGT,MAAM,CAACI,MAAM,IAAIL,QAAQ,GAAGc,QAAQ,CAACO,MAAM,CAAC,CAAC;QAC7Ff,GAAG,CAACmB,QAAQ,CAACR,IAAI,EAAE,GAAG,GAAGhB,MAAM,CAACG,KAAK,GAAGM,SAAS,EAAGV,QAAQ,GAAG,GAAG,IAAKkB,CAAC,GAAG,CAAC,CAAC,CAAC;QAC9EZ,GAAG,CAACiB,OAAO,CAAC,CAAC;MACf,CAAC,CAAC;MACFzB,OAAO,CAACG,MAAM,CAACyB,SAAS,CAAC,CAAC,CAAC;IAC7B,CAAC,CAAC,OAAOC,CAAC,EAAE;MACV5B,MAAM,CAAC,CAAC;IACV;EACF,CAAC,CAAC;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}