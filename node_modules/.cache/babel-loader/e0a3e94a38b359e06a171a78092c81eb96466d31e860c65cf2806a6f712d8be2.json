{"ast":null,"code":"import React,{useEffect,useState}from'react';import'../App.css';/** ResultBoxプロパティ */import{jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const ResultBox=_ref=>{let{text,font,color}=_ref;/** 結果png */const[png,setPng]=useState(null);/**\n   * プレビュー用canvas描画\n   */const getPngFromString=async text=>{return new Promise((resolve,reject)=>{try{const fontSize=32;const canvas=document.createElement('canvas');canvas.width=128;canvas.height=128;const ctx=canvas.getContext('2d');ctx.fillStyle=color;ctx.font=`${fontSize}px '${font.name}', serif`;// draw\nconst textLine=text.split('\\n');textLine.forEach((line,i)=>{ctx.save();const lineWidth=ctx.measureText(line).width;ctx.scale(canvas.width/lineWidth,4/textLine.length);ctx.fillText(line,0,(fontSize-4)*(i+1));ctx.restore();});resolve(canvas.toDataURL());}catch(e){reject();}});};useEffect(()=>{(async()=>{const png=await getPngFromString(text);setPng(png);})();},[text,font,color]);/**\n   * 全角1,半角0.5として文字長を返す\n   * @param str 長さを計算する文字列\n   * @returns number 文字長\n   */const getLength=str=>{var _str$match;// 全角文字以外の文字数\nconst fullWidthLength=((_str$match=str.match(/[^ -~｡-ﾟ]/g))!==null&&_str$match!==void 0?_str$match:[]).length;// 半角文字の文字数\nconst halfWidthLength=str.length-fullWidthLength;return fullWidthLength+halfWidthLength*0.6;};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"reault\",children:png&&/*#__PURE__*/_jsx(\"div\",{className:\"comp\",style:{display:'flex'},children:/*#__PURE__*/_jsx(\"img\",{alt:\"result\",src:png})})})})});};export default ResultBox;","map":{"version":3,"names":["React","useEffect","useState","jsx","_jsx","Fragment","_Fragment","ResultBox","_ref","text","font","color","png","setPng","getPngFromString","Promise","resolve","reject","fontSize","canvas","document","createElement","width","height","ctx","getContext","fillStyle","name","textLine","split","forEach","line","i","save","lineWidth","measureText","scale","length","fillText","restore","toDataURL","e","getLength","str","_str$match","fullWidthLength","match","halfWidthLength","children","className","style","display","alt","src"],"sources":["/Volumes/EXTHDD/Macmini/misskey/emojiCreator/pagesTest/src/components/ResultBox.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport '../App.css';\nimport { Font } from './FontButton';\n\n/** ResultBoxプロパティ */\ntype ResultBoxProps = {\n  text: string,\n  font: Font,\n  color: string,\n}\n\nconst ResultBox = ({ text, font, color }: ResultBoxProps) => {\n  /** 結果png */\n  const [png, setPng] = useState<string | null>(null)\n\n  /**\n   * プレビュー用canvas描画\n   */\n  const getPngFromString = async (text: string): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      try {\n        const fontSize = 32;\n        const canvas = document.createElement('canvas');\n        canvas.width = 128;\n        canvas.height = 128;\n        const ctx = canvas.getContext('2d')!;\n        ctx.fillStyle = color;\n        ctx.font = `${fontSize}px '${font.name}', serif`;\n\n        // draw\n        const textLine = text.split('\\n');\n        textLine.forEach((line, i) => {\n          ctx.save();\n          const lineWidth = ctx.measureText(line).width;\n          ctx.scale(canvas.width / lineWidth, 4 / textLine.length);\n          ctx.fillText(line, 0, (fontSize - 4) * (i + 1));\n          ctx.restore();\n        });\n        resolve(canvas.toDataURL());\n      } catch (e) {\n        reject();\n      }\n    });\n  }\n\n  useEffect(() => {\n    (async () => {\n      const png = await getPngFromString(text);\n      setPng(png);\n    })();\n  }, [text, font, color])\n\n  /**\n   * 全角1,半角0.5として文字長を返す\n   * @param str 長さを計算する文字列\n   * @returns number 文字長\n   */\n  const getLength = (str: string): number => {\n    // 全角文字以外の文字数\n    const fullWidthLength = (str.match(/[^ -~｡-ﾟ]/g) ?? []).length;\n\n    // 半角文字の文字数\n    const halfWidthLength = str.length - fullWidthLength;\n    return fullWidthLength + halfWidthLength * 0.6;\n  }\n\n  return (\n    <>\n      <div>\n        <span className='reault'>\n          {png && (\n            <div className=\"comp\" style={{ display: 'flex' }}>\n              <img alt=\"result\" src={png} />\n            </div>\n          )}\n        </span>\n      </div>\n    </>\n  );\n}\n\nexport default ResultBox;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}